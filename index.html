<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>คุยกับไอริน</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/chat-console.css">
<style>
</style>
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/rivescript.js"></script>
<script src="js/wordcut.min.js"></script>
<script>
/*var uniqueid = 'xxxxxxxxxxx7a2exxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
    return v.toString(16);
});*/
// Create our RiveScript interpreter.
var rs = new RiveScript({
	debug_div: "debug",
	debug:     false
});
var wordcut = require('wordcut');
wordcut.init();


// Load our files from the brain/ folder.
rs.loadFile([
	"brain/spellcheck.rive",
	"brain/irin.rive",
	"brain/date.rive",
	"brain/javascript.rive"
	], on_load_success, on_load_error);
function on_load_success () {
	$("#msg-in").removeAttr("disabled");
	$("#msg-in").attr("placeholder", "Send message");
	$("#msg-in").focus();
	rs.sortReplies();
}

function on_load_error (err) {
	console.log("Loading error: " + err);
}
    
function cutthai(msg){
    var lastchar = msg.charAt(msg.length - 1);
    if(lastchar=="?"){
        msg = msg.substr(0,msg.length-1);
    }
    msg = wordcut.cut(msg);
    msg = msg.replace(/\|/g," ");
    msg = msg.replace("   "," ");
    return msg;
}

function sendMSG(){
	var msg = $("#msg-in").val();
	 $("#msg-in").val("");
	 $("#chat-display").append("<li class='right clearfix'><span class='chat-img pull-right'><img src='https://placehold.it/50/FA6F57/fff&text=ME' alt='User Avatar' class='img-circle' /></span><div class='chat-body clearfix'><div class='header'><strong class='pull-right primary-font'>ฉัน</strong></div><br><p class='pull-right'>"+msg+"</p></div></li>")
	try {

		var reply = rs.reply("user", cutthai(msg));
		reply = reply.replace(/\n/g, "<br>");
		if(reply=="ขออภัยค่ะ ไอรินไม่เข้าใจค่ะ ช่วยสอนไอรินเพิ่มด้วยนะคะ"){
			if(sessionStorage.length==0){
				$.get("https://log.pureapp.in.th/irin/add.php?c="+msg);
			} else {
				$.get("https://log.pureapp.in.th/irin/add.php?c="+msg+"&p="+sessionStorage.old);
			}
		}else{
			sessionStorage.old = reply;
		}
		$("#chat-display").append("<li class='left clearfix'><span class='chat-img pull-left'><img src='https://placehold.it/50/55C1E7/fff&text=IRIN' alt='User Avatar' class='img-circle' /></span><div class='chat-body clearfix'><div class='header'><strong class='primary-font'>ไอริน</strong></div><p>"+reply+"</p></div></li>");
		$(".panel-body").scrollTop($('#chat-display').height());
	} catch(e) {
		window.alert(e.message + "\n" + e.line);
		console.log(e);
	}
	
}
$(function() {
	$("#msg-in").keyup(function(e){
		code= (e.keyCode ? e.keyCode : e.which);
		if(code==13){
			sendMSG();
		}
	});
});
</script>
</head>
<body>
<div class="container">
    <div class="row">
		<div class="col-md-2"></div>
        <div class="col-md-8">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> ไอริน
                    <div class="btn-group pull-right">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </button>
                        <ul class="dropdown-menu slidedown">
                            <li><a href="http://www.jquery2dotnet.com"><span class="glyphicon glyphicon-time"></span>
									แบ่งปัน</a></li>
                            <li class="divider"></li>
                            <li><a href="http://www.jquery2dotnet.com"><span class="glyphicon glyphicon-off"></span>
								แจ้งปัญหา</a></li>
                        </ul>
                    </div>
                </div>
                <div class="panel-body">
                    <ul class="chat" id="chat-display">
                        <li class="left clearfix">
							<span class="chat-img pull-left">
								<img src="https://placehold.it/50/55C1E7/fff&text=IRIN" alt="User Avatar" class="img-circle" />
							</span>
							<div class="chat-body clearfix">
                                <div class="header">
                                    <strong class="primary-font">ไอริน</strong>
                                </div>
                                <p>
									สวัสดีค่ะ หนูชื่อไอริน ยินดีที่พบกันนะคะ
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="panel-footer">
                    <div class="input-group">
           				<span class="input-group-btn">
                            <a class="btn btn-default btn-sm" id="btn-chat" href="https://goo.gl/forms/nqq95wtwjC" target="_blank">
								สอนศัพท์ใหม่</a>
                        </span>
						<input id="msg-in" type="text" class="form-control input-sm" placeholder="Loading..." disabled/>
                        <span class="input-group-btn">
                            <button class="btn btn-info btn-sm" id="btn-chat" onclick="sendMSG()">
								ส่งข้อความ</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>